# =============================================================================
# =============================================================================
#
#   ğŸš€ CRAVE API - PRODUCTION READINESS SETUP GUIDE
#
#   Last Updated: January 2026
#   Session Context: Production-readiness implementation
#
# =============================================================================
# =============================================================================
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  ğŸ“‹ WHAT WAS ADDED IN THIS SESSION                                         â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   1. HEALTH CHECK MODULE (apps/api/src/modules/health/)
#      - GET /health        â†’ Full health check (DB + Redis)
#      - GET /health/live   â†’ Liveness probe (always returns 200 if server up)
#      - GET /health/ready  â†’ Readiness probe (checks DB + Redis)
#      Purpose: Railway uses these to know when your container is healthy
#
#   2. SENTRY ERROR TRACKING (apps/api/src/sentry/)
#      - SentryFilter: Captures all 5xx errors automatically
#      - SentryInterceptor: Performance monitoring for all requests
#      - Configured in main.ts (MUST be first import)
#      Purpose: See all production errors with full stack traces + context
#
#   3. RATE LIMITING (apps/api/src/modules/infrastructure/throttler/)
#      - Redis-backed distributed rate limiting
#      - 3 tiers: short (5/1s), medium (30/10s), long (100/60s)
#      - Decorators: @ShortRateLimit, @MediumRateLimit, @LongRateLimit
#      Purpose: Protect against abuse, DDoS, runaway clients
#
#   4. DEBUG MODULE (apps/api/src/modules/debug/)
#      - GET  /api/debug/sentry-test       â†’ Throws test error for Sentry
#      - POST /api/debug/sentry-message    â†’ Sends test message to Sentry
#      - GET  /api/debug/sentry-async-error â†’ Tests async error capture
#      Purpose: Verify Sentry integration is working
#      âš ï¸  DISABLE THIS MODULE IN PRODUCTION (remove from app.module.ts)
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  âœ… SETUP CHECKLIST - COMPLETE THESE ON YOUR MAC                           â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   [ ] 1. MERGE ENV VARIABLES
#          Your Mac has a more complete .env file. Add these NEW variables to it:
#          - SENTRY_DSN (copy from below)
#          - SENTRY_ENVIRONMENT=development
#          - SENTRY_TRACES_SAMPLE_RATE=1.0
#          - SENTRY_PROFILES_SAMPLE_RATE=1.0
#          - THROTTLER_SHORT_TTL, THROTTLER_SHORT_LIMIT, etc. (see bottom)
#
#   [ ] 2. INSTALL NEW DEPENDENCIES
#          cd apps/api && yarn install
#          New packages: @sentry/nestjs, @sentry/profiling-node
#
#   [ ] 3. START SERVICES & TEST
#          docker-compose up -d          # Start PostgreSQL + Redis
#          yarn workspace api start:dev  # Start API
#
#   [ ] 4. TEST HEALTH ENDPOINT
#          curl http://localhost:3000/health
#          Expected: {"status":"healthy","checks":{"database":"healthy","redis":"healthy"}}
#
#   [ ] 5. TEST SENTRY INTEGRATION
#          curl http://localhost:3000/api/debug/sentry-test
#          Check Sentry dashboard for the error within ~10 seconds
#
#   [ ] 6. SETUP SENTRY ALERTS (see detailed guide below)
#
#   [ ] 7. DEPLOY TO RAILWAY (see detailed guide below)
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  ğŸ”” SENTRY ALERT CONFIGURATION GUIDE                                       â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   Your current alert setup has some issues. Here's the recommended approach:
#
#   PROBLEM WITH CURRENT SETUP:
#   - Using "all" filter means ALL conditions must match (too restrictive)
#   - Having multiple "users affected" conditions with "all" is redundant
#   - 10 occurrences minimum is too high to catch issues early
#   - One alert trying to do everything = alert fatigue or missed issues
#
#   RECOMMENDED: CREATE 3 SEPARATE ALERTS
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ ALERT 1: "New Issue Alert" (Catch new bugs immediately)                â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ Environment: All Environments                                          â”‚
#   â”‚ Project: crave-api (make sure this is your NestJS project!)            â”‚
#   â”‚                                                                         â”‚
#   â”‚ WHEN: A new issue is created                                            â”‚
#   â”‚                                                                         â”‚
#   â”‚ IF: The issue's level is equal to "error" or "fatal"                    â”‚
#   â”‚                                                                         â”‚
#   â”‚ THEN: Send Discord notification                                         â”‚
#   â”‚       Tags to show: environment, url, user.email                        â”‚
#   â”‚                                                                         â”‚
#   â”‚ Interval: 1 hour (prevents spam for same issue)                         â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ ALERT 2: "Error Spike Alert" (Catch when things go wrong fast)         â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ Environment: production                                                 â”‚
#   â”‚ Project: crave-api                                                      â”‚
#   â”‚                                                                         â”‚
#   â”‚ WHEN: Number of events in an issue is more than 50 in 1 hour            â”‚
#   â”‚                                                                         â”‚
#   â”‚ IF: (no additional filters)                                             â”‚
#   â”‚                                                                         â”‚
#   â”‚ THEN: Send Discord notification                                         â”‚
#   â”‚       Tags to show: environment, url, browser                           â”‚
#   â”‚                                                                         â”‚
#   â”‚ Interval: 1 hour                                                        â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ ALERT 3: "User Impact Alert" (Catch widespread issues)                 â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ Environment: production                                                 â”‚
#   â”‚ Project: crave-api                                                      â”‚
#   â”‚                                                                         â”‚
#   â”‚ WHEN: Number of users affected by an issue is more than 10 in 1 hour    â”‚
#   â”‚                                                                         â”‚
#   â”‚ IF: (no additional filters)                                             â”‚
#   â”‚                                                                         â”‚
#   â”‚ THEN: Send Discord notification                                         â”‚
#   â”‚       Tags to show: environment, user.email, url                        â”‚
#   â”‚                                                                         â”‚
#   â”‚ Interval: 30 minutes                                                    â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   WHY THIS IS BETTER:
#   âœ“ Alert 1: Catches new bugs immediately (you want to know ASAP)
#   âœ“ Alert 2: Catches volume spikes (something broke badly)
#   âœ“ Alert 3: Catches user impact (many users hitting same bug)
#   âœ“ Each alert has ONE job = easier to tune, less noise
#   âœ“ Lower thresholds catch issues before they become critical
#
#   DISCORD CHANNEL ID (not URL):
#   - Right-click your Discord channel â†’ "Copy Channel ID"
#   - Enable Developer Mode: User Settings â†’ App Settings â†’ Advanced â†’ Developer Mode
#   - The ID looks like: 1234567890123456789 (just numbers)
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  ğŸš‚ RAILWAY DEPLOYMENT GUIDE                                               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   Railway was chosen because:
#   - Hosts NestJS + PostgreSQL + Redis in one place
#   - Easy GitHub integration with auto-deploy
#   - Generous free tier ($5/month credit)
#   - Simple environment variable management
#   - Built-in health checks
#
#   STEP-BY-STEP DEPLOYMENT:
#
#   1. CREATE RAILWAY ACCOUNT
#      - Go to https://railway.app
#      - Sign up with GitHub (recommended)
#
#   2. CREATE NEW PROJECT
#      - Click "New Project" â†’ "Deploy from GitHub Repo"
#      - Select your Crave repository
#      - Railway will detect it's a monorepo
#
#   3. ADD POSTGRESQL
#      - Click "+ New" â†’ "Database" â†’ "Add PostgreSQL"
#      - Railway auto-creates DATABASE_URL variable
#      - Note: This is a managed PostgreSQL instance
#
#   4. ADD REDIS
#      - Click "+ New" â†’ "Database" â†’ "Add Redis"
#      - Railway auto-creates REDIS_URL variable
#
#   5. CONFIGURE API SERVICE
#      Settings â†’ Build:
#        Root Directory: apps/api
#        Build Command: yarn install && yarn build
#        Start Command: yarn start:prod
#
#      Settings â†’ Deploy:
#        Health Check Path: /health
#        Restart Policy: Always
#
#   6. SET ENVIRONMENT VARIABLES
#      Go to Variables tab and add:
#
#      # Railway provides these automatically (use variable references):
#      DATABASE_URL=${{Postgres.DATABASE_URL}}
#      REDIS_URL=${{Redis.REDIS_URL}}
#
#      # You need to set these manually:
#      NODE_ENV=production
#      APP_ENV=prod
#
#      # Sentry (use lower sample rates in production!)
#      SENTRY_DSN=<your-dsn>
#      SENTRY_ENVIRONMENT=production
#      SENTRY_TRACES_SAMPLE_RATE=0.1
#      SENTRY_PROFILES_SAMPLE_RATE=0.1
#
#      # Copy all other API keys from your .env file:
#      # - CLERK_SECRET_KEY
#      # - LLM_API_KEY_PROD
#      # - GOOGLE_PLACES_API_KEY_PROD
#      # - STRIPE_* variables
#      # - etc.
#
#   7. DEPLOY
#      - Push to main branch â†’ Railway auto-deploys
#      - Or click "Deploy" button manually
#
#   8. RUN MIGRATIONS (first deploy only)
#      - Railway CLI: railway run yarn workspace api db:migrate
#      - Or use Railway's one-off command feature
#
#   9. GET YOUR PUBLIC URL
#      - Railway provides: https://crave-api-production.up.railway.app
#      - Add custom domain in Settings â†’ Domains
#
#   COST ESTIMATE:
#   - Hobby Plan: $5 free credit/month (good for testing)
#   - Pro Plan: $20/month (recommended for production)
#     - Better resource limits
#     - Team features
#     - Priority support
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  ğŸ“ FILES CREATED/MODIFIED IN THIS SESSION                                 â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   NEW FILES:
#   - apps/api/src/modules/health/health.service.ts
#   - apps/api/src/modules/health/health.controller.ts
#   - apps/api/src/modules/health/health.module.ts
#   - apps/api/src/modules/health/index.ts
#   - apps/api/src/sentry/sentry.filter.ts
#   - apps/api/src/sentry/sentry.interceptor.ts
#   - apps/api/src/sentry/sentry.module.ts
#   - apps/api/src/sentry/index.ts
#   - apps/api/src/modules/infrastructure/throttler/throttler-redis.storage.ts
#   - apps/api/src/modules/infrastructure/throttler/throttler.decorator.ts
#   - apps/api/src/modules/infrastructure/throttler/throttler.module.ts
#   - apps/api/src/modules/infrastructure/throttler/index.ts
#   - apps/api/src/modules/infrastructure/index.ts
#   - apps/api/src/modules/debug/debug.controller.ts
#   - apps/api/src/modules/debug/debug.module.ts
#   - apps/api/src/modules/debug/index.ts
#
#   MODIFIED FILES:
#   - apps/api/src/main.ts (added Sentry.init at top, health route exclusion)
#   - apps/api/src/app.module.ts (imported new modules)
#   - apps/api/src/config/configuration.ts (added sentry/throttler config)
#   - apps/api/package.json (added Sentry dependencies)
#   - apps/api/.env.example (this file - added new variables)
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  âš ï¸  BEFORE PRODUCTION DEPLOYMENT                                          â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   1. LOWER SENTRY SAMPLE RATES (saves money):
#      SENTRY_TRACES_SAMPLE_RATE=0.1   # 10% of requests
#      SENTRY_PROFILES_SAMPLE_RATE=0.1 # 10% of requests
#
#   2. DISABLE OR PROTECT DEBUG MODULE:
#      Option A: Remove DebugModule from app.module.ts imports
#      Option B: Add auth guard to debug endpoints
#      The debug endpoints let anyone trigger errors!
#
#   3. RUN LINTING:
#      yarn workspace api lint
#      (Required per AGENTS.md before committing)
#
# =============================================================================
# =============================================================================
#
#   STANDARD ENVIRONMENT VARIABLES BEGIN BELOW
#
# =============================================================================
# =============================================================================

# Environment namespace (recommended)
# - Use separate API keys per environment.
# - Prefer separate Redis instances per environment in production.
#
# NOTE: `.env` files do not expand variables automatically, so set full values.

# `dev` | `prod`
APP_ENV=dev

# Optional overrides (defaults derive from `APP_ENV`)
# BULL_PREFIX=crave:dev
# LLM_RATE_LIMIT_PREFIX=crave:dev:llm-rate-limiter

# Disable background schedulers (useful for test runs)
TEST_COLLECTION_JOBS_ENABLED=false
UNIFIED_PROCESSING_DRY_RUN=false
TEST_DRY_RUN=false

# LLM system instruction cache Redis key (selected by `APP_ENV`)
LLM_SYSTEM_CACHE_REDIS_KEY_DEV=crave:dev:llm:system-instruction-cache
LLM_SYSTEM_CACHE_REDIS_KEY_PROD=crave:prod:llm:system-instruction-cache
LLM_QUERY_RESULT_CACHE_REDIS_KEY_DEV=crave:dev:llm:query-analysis
LLM_QUERY_RESULT_CACHE_REDIS_KEY_PROD=crave:prod:llm:query-analysis

# LLM API key (selected by `APP_ENV`)
LLM_API_KEY_DEV=
LLM_API_KEY_PROD=
LLM_QUERY_TIMEOUT=0
LLM_QUERY_LOG_OUTPUTS=false
LLM_THINKING_ENABLED=true
LLM_THINKING_LEVEL=LOW
LLM_QUERY_THINKING_LEVEL=MINIMAL
LLM_THINKING_INCLUDE_THOUGHTS=false
LLM_THINKING_BUDGET=0
LLM_DEBUG_THOUGHTS_ONCE=false
LLM_DEBUG_THOUGHTS_QUERY=true
LLM_DEBUG_THOUGHTS_CONTENT=true
LLM_DEBUG_THOUGHTS_MAX_CHARS=0
LLM_DEBUG_THOUGHTS_MAX_QUERIES=1
LLM_DEBUG_THOUGHTS_MAX_CONTENT_CHUNKS=1
LLM_DEBUG_THOUGHTS_WRITE_FILE=false
LLM_DEBUG_THOUGHTS_FILE_PATH_QUERY=apps/api/logs/llm-thought-debug-query.json
LLM_DEBUG_THOUGHTS_FILE_PATH_CONTENT=apps/api/logs/llm-thought-debug-content.json
LLM_HEADERS_TIMEOUT_MS=120000
LLM_BODY_TIMEOUT_MS=300000
LLM_CONNECT_TIMEOUT_MS=30000
LLM_QUERY_RESULT_CACHE_TTL_SECONDS=0
LLM_QUERY_RESULT_CACHE_VERSION=v1
LLM_QUERY_RESULT_CACHE_LOCAL_TTL_SECONDS=0
LLM_QUERY_RESULT_CACHE_LOCAL_MAX_ENTRIES=0
LLM_QUERY_RESULT_CACHE_INCLUDE_METADATA=false
ENTITY_RESOLUTION_CACHE_REDIS_KEY_DEV=crave:dev:entity-resolution
ENTITY_RESOLUTION_CACHE_REDIS_KEY_PROD=crave:prod:entity-resolution
ENTITY_RESOLUTION_CACHE_TTL_SECONDS=0
ENTITY_RESOLUTION_CACHE_NEGATIVE_TTL_SECONDS=0
ENTITY_RESOLUTION_CACHE_LOCAL_TTL_SECONDS=0
ENTITY_RESOLUTION_CACHE_LOCAL_MAX_ENTRIES=0
ENTITY_RESOLUTION_CACHE_VERSION=v1

# Google Places API key (selected by `APP_ENV`)
GOOGLE_PLACES_API_KEY_DEV=
GOOGLE_PLACES_API_KEY_PROD=
GOOGLE_PLACES_TIMEOUT=10000
GOOGLE_PLACES_DEFAULT_RADIUS=5000

# Google Moderation API (selected by `APP_ENV`)
GOOGLE_MODERATION_API_KEY_DEV=
GOOGLE_MODERATION_API_KEY_PROD=
GOOGLE_MODERATION_ENDPOINT=https://contentmoderation.googleapis.com/v1beta/moderations:moderateText

# Reddit API credentials (selected by `APP_ENV`)
REDDIT_CLIENT_ID_DEV=
REDDIT_CLIENT_ID_PROD=
REDDIT_CLIENT_SECRET_DEV=
REDDIT_CLIENT_SECRET_PROD=
REDDIT_USERNAME_DEV=
REDDIT_USERNAME_PROD=
REDDIT_PASSWORD_DEV=
REDDIT_PASSWORD_PROD=

# Fail-fast circuit breakers (ignored in prod)
LLM_MAX_CONSECUTIVE_RATE_LIMITS=3
REDDIT_MAX_CONSECUTIVE_RATE_LIMITS=3

# Rank score refresh window (minutes)
RANK_SCORE_REFRESH_WINDOW_MINUTES=30

# Restaurant enrichment
RESTAURANT_ENRICHMENT_CONCURRENCY=5

# =============================================================================
# SENTRY - Error Tracking & Performance Monitoring
# =============================================================================
# Get your DSN from: https://sentry.io â†’ Project Settings â†’ Client Keys
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_RELEASE=
# Sample rates (0.0 to 1.0) - lower in production to reduce costs
SENTRY_TRACES_SAMPLE_RATE=1.0
SENTRY_PROFILES_SAMPLE_RATE=1.0

# =============================================================================
# RATE LIMITING (Throttler)
# =============================================================================
# Short window: burst protection (requests per second)
THROTTLER_SHORT_TTL=1000
THROTTLER_SHORT_LIMIT=5
# Medium window: 10 second window
THROTTLER_MEDIUM_TTL=10000
THROTTLER_MEDIUM_LIMIT=30
# Long window: 1 minute window  
THROTTLER_LONG_TTL=60000
THROTTLER_LONG_LIMIT=100
